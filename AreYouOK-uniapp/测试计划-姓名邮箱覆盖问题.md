# 姓名邮箱覆盖问题 - 测试计划

## 测试目标

验证修复后,用户修改的姓名和邮箱能够正确保存,不会被旧数据覆盖。

## 测试环境

- **测试平台**: 微信开发者工具 / 真机测试
- **测试账号**: 测试用邮箱
- **测试时间**: 2026-02-04

## 测试用例

### 用例1: 首次签到测试

**测试步骤**:
1. 清空小程序缓存(开发者工具: 清除缓存 > 全部清除)
2. 打开小程序
3. 输入姓名: `张三`
4. 输入邮箱: `test001@example.com`
5. 点击签到按钮

**预期结果**:
- ✅ 签到成功提示
- ✅ 姓名显示为 `张三`
- ✅ 邮箱显示为 `test001@example.com`

**实际结果**:
- [ ] 通过 / [ ] 失败
- 备注: _____________________

---

### 用例2: 修改信息后签到测试

**前置条件**: 已完成用例1

**测试步骤**:
1. 保持小程序打开状态
2. 修改姓名为: `李四`
3. 修改邮箱为: `test002@example.com`
4. 点击签到按钮

**预期结果**:
- ✅ 如果是同一天再次签到,应该提示"今日已签到"
- ✅ 表单中姓名仍然显示为 `李四`
- ✅ 表单中邮箱仍然显示为 `test002@example.com`
- ✅ **关键**: 不会被覆盖回 `张三` 和 `test001@example.com`

**实际结果**:
- [ ] 通过 / [ ] 失败
- 备注: _____________________

---

### 用例3: 第二天签到测试

**前置条件**: 已完成用例1(使用 `张三` 和 `test001@example.com` 签到)

**测试步骤**:
1. 修改系统日期到第二天(或等待第二天)
2. 打开小程序
3. 观察表单是否自动填充
4. 修改姓名为: `李四`
5. 修改邮箱为: `test002@example.com`
6. 点击签到按钮

**预期结果**:
- ✅ 打开小程序时,自动填充 `张三` 和 `test001@example.com`
- ✅ 签到成功
- ✅ 签到后表单中姓名显示为 `李四`
- ✅ 签到后表单中邮箱显示为 `test002@example.com`

**实际结果**:
- [ ] 通过 / [ ] 失败
- 备注: _____________________

---

### 用例4: 持久化测试(关键用例)

**前置条件**: 已完成用例3(使用 `李四` 和 `test002@example.com` 签到)

**测试步骤**:
1. 完全关闭小程序(微信小程序: 长按删除/向上滑动删除)
2. 重新打开小程序
3. 观察表单中的姓名和邮箱

**预期结果**:
- ✅ 姓名自动填充为 `李四` (最新数据)
- ✅ 邮箱自动填充为 `test002@example.com` (最新数据)
- ❌ **不应该**显示 `张三` 和 `test001@example.com` (旧数据)

**实际结果**:
- [ ] 通过 / [ ] 失败
- 备注: _____________________

---

### 用例5: 多次修改测试

**前置条件**: 已完成用例4

**测试步骤**:
1. 修改姓名为: `王五`
2. 修改邮箱为: `test003@example.com`
3. 点击签到按钮(如果不是同一天)
4. 关闭小程序
5. 重新打开小程序
6. 观察表单中的姓名和邮箱

**预期结果**:
- ✅ 签到成功
- ✅ 重新打开后,姓名显示为 `王五`
- ✅ 重新打开后,邮箱显示为 `test003@example.com`

**实际结果**:
- [ ] 通过 / [ ] 失败
- 备注: _____________________

---

### 用例6: 修改后不签到测试

**前置条件**: 小程序中有已保存的用户信息

**测试步骤**:
1. 打开小程序
2. 修改姓名(但不点击签到)
3. 关闭小程序
4. 重新打开小程序
5. 观察姓名是否被修改

**预期结果**:
- ✅ 姓名恢复为修改前的值(因为没有签到,所以没有保存)
- ✅ 这是正常行为,只有签到成功后才保存新数据

**实际结果**:
- [ ] 通过 / [ ] 失败
- 备注: _____________________

---

### 用例7: 本地存储优先级测试

**测试目的**: 验证本地存储的数据优先级高于服务器数据

**测试步骤**:
1. 使用浏览器/开发者工具查看 localStorage
2. 手动修改 `userName` 为 `测试姓名`
3. 手动修改 `userEmail` 为 `test@test.com`
4. 刷新小程序
5. 观察表单中的姓名和邮箱

**预期结果**:
- ✅ 姓名显示为 `测试姓名`
- ✅ 邮箱显示为 `test@test.com`
- ✅ 本地存储优先于服务器数据

**实际结果**:
- [ ] 通过 / [ ] 失败
- 备注: _____________________

---

## 后端验证(需要开发者协助)

### 验证1: 签到时是否更新用户信息

**验证方法**:
1. 查看后端日志
2. 或直接查询数据库

**SQL查询**:
```sql
-- 查看用户信息是否更新
SELECT USER_ID, NICKNAME, EMAIL, UPDATE_TIME 
FROM T_USER 
WHERE EMAIL = 'test002@example.com';

-- 查看签到记录
SELECT * FROM T_SIGN_RECORD 
WHERE USER_ID = (SELECT USER_ID FROM T_USER WHERE EMAIL = 'test002@example.com')
ORDER BY SIGN_DATE DESC 
LIMIT 5;
```

**预期结果**:
- ✅ `NICKNAME` 字段应该是最新的姓名(`李四`)
- ✅ `EMAIL` 字段应该是最新的邮箱(`test002@example.com`)
- ✅ `UPDATE_TIME` 应该是最后一次签到的时间

---

### 验证2: 获取用户信息接口返回值

**验证方法**:
1. 调用 `GET /api/user/info?email=test002@example.com`
2. 查看返回的 `nickname` 和 `email` 字段

**预期结果**:
```json
{
  "code": 0,
  "message": "获取成功",
  "data": {
    "userId": 12345,
    "nickname": "李四",  // 应该是最新的姓名
    "email": "test002@example.com",  // 应该是最新的邮箱
    // ... 其他字段
  }
}
```

---

## 测试总结

### 通过标准

- [ ] 所有前端测试用例通过
- [ ] 后端验证通过
- [ ] 无新增bug

### 测试结论

- **测试日期**: _____________________
- **测试人员**: _____________________
- **测试结果**: [ ] 通过 / [ ] 失败
- **失败原因**: _____________________

### 遗留问题

1. _____________________
2. _____________________
3. _____________________

---

## 备注

- 测试时请确保网络连接正常
- 建议使用微信开发者工具的"清除缓存"功能进行测试
- 如果遇到问题,请查看控制台日志
- 可以使用不同的测试邮箱进行多次测试

## 相关文档

- [姓名邮箱覆盖问题修复说明.md](./姓名邮箱覆盖问题修复说明.md)
- [API接口文档.md](../项目文件/API接口文档.md)
