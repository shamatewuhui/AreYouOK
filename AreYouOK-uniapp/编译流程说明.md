# uniapp 项目编译流程说明

## 重要提示

⚠️ **编译输出已清理，需要重新编译！**

由于之前的修复脚本存在 bug，导致编译后的 WXML 文件被破坏。已修复脚本并清理损坏的编译输出。

## 编译步骤

### 方法一：使用 HBuilderX（推荐）

1. **打开项目**
   - 使用 HBuilderX 打开 `AreYouOK-uniapp` 目录

2. **编译为微信小程序**
   - 点击菜单：运行 → 运行到小程序模拟器 → 微信开发者工具
   - 或者点击工具栏的运行按钮

3. **运行修复脚本**
   ```bash
   cd AreYouOK-uniapp
   node fix-compile-errors.js
   ```

4. **在微信开发者工具中重新加载**
   - 点击"编译" 或按 `Cmd+B` (Mac) / `Ctrl+B` (Windows)

### 方法二：使用命令行

1. **编译项目**
   ```bash
   cd AreYouOK-uniapp
   npm run dev:mp-weixin
   ```

2. **运行修复脚本**
   ```bash
   node fix-compile-errors.js
   ```

3. **打开微信开发者工具**
   - 导入项目：选择 `AreYouOK-uniapp/dist/dev/mp-weixin` 目录
   - 点击"编译"

### 方法三：使用自定义 build.js

1. **运行构建脚本**
   ```bash
   cd AreYouOK-uniapp
   node build.js
   ```

2. **运行修复脚本**
   ```bash
   node fix-compile-errors.js
   ```

3. **打开微信开发者工具**
   - 导入项目：选择 `AreYouOK-uniapp/dist/dev/mp-weixin` 目录
   - 点击"编译"

## 修复脚本说明

`fix-compile-errors.js` 会自动修复以下问题：

### WXML 修复
- ✅ `@change` → `bindchange`
- ✅ `v-on:change` → `bindchange`
- ✅ `:value` → `value="{{...}}"`
- ✅ `:start` → `start="{{...}}"`
- ✅ `:end` → `end="{{...}}"`
- ✅ 重复的 `class` 属性合并（同一行）
- ✅ 数组形式的 class 绑定语法修复

### JavaScript 修复
- ✅ `Page: function({` → `Page({`
- ✅ `if: function(...)` → `if (...)`
- ✅ `for: function(...)` → `for (...)`
- ✅ `while: function(...)` → `while (...)`
- ✅ `switch: function(...)` → `switch (...)`
- ✅ `catch: function(...)` → `catch (...)`
- ✅ 自动为包含 `await` 的函数添加 `async` 关键字

## 自动化脚本（推荐）

可以在 `package.json` 中添加以下脚本，实现编译后自动修复：

```json
{
  "scripts": {
    "dev:mp-weixin": "uni -p mp-weixin && node fix-compile-errors.js",
    "build:mp-weixin": "uni build -p mp-weixin && node fix-compile-errors.js",
    "fix": "node fix-compile-errors.js"
  }
}
```

然后运行：
```bash
npm run dev:mp-weixin
```

## 常见问题

### Q1: 编译后仍有错误？
**A:** 确保每次编译后都运行修复脚本：
```bash
node fix-compile-errors.js
```

### Q2: 文件被破坏怎么办？
**A:** 清理编译输出并重新编译：
```bash
rm -rf dist/dev/mp-weixin
npm run dev:mp-weixin
node fix-compile-errors.js
```

### Q3: 修复脚本报错？
**A:** 检查是否有编译输出：
```bash
ls -la dist/dev/mp-weixin/
```
如果目录不存在，需要先编译项目。

### Q4: 微信开发者工具报错？
**A:** 常见错误及解决方案：

1. **`__route__ is not defined`**
   - 这是运行时警告，不影响功能，可以忽略

2. **`module is not defined`**
   - 说明 JS 文件有语法错误
   - 运行修复脚本后重新编译

3. **标签不匹配错误**
   - 说明 WXML 文件被破坏
   - 清理编译输出并重新编译

## 开发工作流

推荐的开发流程：

1. **修改源代码** → `pages/*.vue`
2. **编译项目** → HBuilderX 或 `npm run dev:mp-weixin`
3. **运行修复脚本** → `node fix-compile-errors.js`
4. **测试** → 微信开发者工具中测试
5. **重复 1-4** → 持续开发

## 注意事项

⚠️ **重要：**
- 每次修改源代码后都需要重新编译
- 每次编译后都需要运行修复脚本
- 不要手动编辑 `dist/` 目录下的文件（会被覆盖）
- 微信小程序基础库需要 **2.10.0 或更高** 才支持 `async/await`

## 项目结构

```
AreYouOK-uniapp/
├── pages/                  # 源代码（Vue 文件）
│   ├── index/
│   ├── sign/
│   └── user/
├── dist/                   # 编译输出（不要手动编辑）
│   └── dev/
│       └── mp-weixin/      # 微信小程序代码
├── build.js               # 自定义构建脚本
├── fix-compile-errors.js  # 编译后修复脚本 ⭐
├── package.json
└── vite.config.js
```

## 技术支持

如遇到其他问题，请查看：
- `编译错误修复说明.md` - 详细的错误修复文档
- `CHANGELOG.md` - 版本更新日志
- 或联系开发团队
