# 君安否小程序 - 项目结构说明

## 目录结构

```
AreYouOK-uniapp/
├── pages/                      # 页面文件夹
│   ├── index/                  # 首页（签到页面）
│   │   └── index.vue          # 首页组件
│   ├── user/                   # 用户相关页面
│   │   └── info.vue           # 用户信息页面
│   └── sign/                   # 签到相关页面
│       └── records.vue        # 签到记录页面
│
├── utils/                      # 工具类文件夹
│   ├── api.js                 # API接口封装
│   ├── config.js              # 配置文件
│   ├── store.js               # 全局状态管理
│   └── validate.js            # 表单验证工具
│
├── static/                     # 静态资源文件夹
│   ├── README.md              # 静态资源说明
│   └── default-avatar.png     # 默认头像（需自行添加）
│
├── App.vue                     # 应用入口文件
├── pages.json                  # 页面路由配置
├── manifest.json               # 应用配置
├── package.json                # 项目依赖配置
├── vite.config.js              # Vite构建配置
├── README.md                   # 项目说明
├── CHANGELOG.md                # 更新日志
├── 前端开发完善说明.md         # 前端开发文档
├── 部署配置说明.md             # 部署配置文档
└── 项目结构说明.md             # 本文件
```

---

## 文件说明

### 📄 核心页面文件

#### `pages/index/index.vue`
**功能**：首页签到页面
- 用户姓名和邮箱输入
- 签到按钮和签到功能
- 用户信息快捷入口（显示连续签到和累计签到）
- 底部功能按钮（跳转到签到记录）
- 签到成功/失败提示

**依赖**：
- `utils/api.js` - API接口
- `utils/validate.js` - 表单验证
- `utils/store.js` - 状态管理

**页面路由**：`/pages/index/index`

---

#### `pages/user/info.vue`
**功能**：用户信息页面
- 用户头像、昵称、邮箱展示
- 签到统计卡片（连续签到、累计签到、最后签到时间）
- 功能操作区域（查看签到记录、刷新信息）
- 返回首页按钮

**依赖**：
- `utils/api.js` - API接口
- `utils/store.js` - 状态管理

**页面路由**：`/pages/user/info`

**接口调用**：
- `GET /api/user/info?openid={openid}`
- `GET /api/user/info?email={email}`

---

#### `pages/sign/records.vue`
**功能**：签到记录页面
- 签到记录列表（日期、时间格式化显示）
- 顶部统计信息（总记录数）
- 日期筛选功能
- 分页加载（每页20条）
- 下拉刷新和上拉加载更多
- 空状态提示

**依赖**：
- `utils/api.js` - API接口
- `utils/store.js` - 状态管理

**页面路由**：`/pages/sign/records`

**接口调用**：
- `GET /api/sign/records?openid={openid}&page=1&pageSize=20`

---

### 🔧 工具类文件

#### `utils/api.js`
**功能**：API接口封装
- 统一的请求方法
- 错误处理
- 响应数据格式化

**导出方法**：
```javascript
signIn(data)              // 用户签到
getUserInfo(openid)       // 获取用户信息（通过openid）
getUserInfoByEmail(email) // 获取用户信息（通过email）
getSignRecords(params)    // 获取签到记录
```

**配置项**：
- `BASE_URL` - API基础地址（需要修改）

---

#### `utils/config.js`
**功能**：应用配置管理
- 开发环境配置
- 生产环境配置
- 应用信息
- 本地存储键名
- 分页配置

**导出内容**：
```javascript
{
  baseURL: '',           // API基础地址
  timeout: 10000,        // 请求超时时间
  enableLog: true,       // 是否开启日志
  appName: '君安否',     // 应用名称
  appVersion: '1.0.0',   // 应用版本
  storageKeys: {},       // 本地存储键名
  defaultAvatar: '',     // 默认头像路径
  pagination: {}         // 分页配置
}
```

---

#### `utils/store.js`
**功能**：全局状态管理
- 用户信息状态管理
- 登录状态管理
- 数据持久化

**核心方法**：
```javascript
setUserInfo(userInfo)        // 设置用户信息
getUserInfo()                // 获取用户信息
clearUserInfo()              // 清除用户信息
isUserLogin()                // 检查登录状态
updateSignInfo(signData)     // 更新签到信息
```

**数据结构**：
```javascript
state: {
  userInfo: {
    userId: 12345,
    openid: '',
    nickname: '',
    avatarUrl: '',
    email: '',
    emailVerified: false,
    lastSignTime: '',
    continuousDays: 0,
    totalSignDays: 0,
    status: 1
  },
  isLogin: false
}
```

---

#### `utils/validate.js`
**功能**：表单验证工具
- 邮箱格式验证
- 姓名格式验证
- 必填项验证

**导出方法**：
```javascript
validateEmail(email)   // 验证邮箱格式
validateName(name)     // 验证姓名格式（2-20个字符）
validateRequired(value) // 验证必填项
```

---

### 📋 配置文件

#### `pages.json`
**功能**：页面路由配置
- 页面路径定义
- 导航栏样式配置
- 下拉刷新配置
- 全局样式配置

**配置页面**：
- `pages/index/index` - 首页
- `pages/user/info` - 用户信息页
- `pages/sign/records` - 签到记录页

---

#### `manifest.json`
**功能**：应用配置
- 应用名称、版本
- 小程序 AppID
- 权限配置
- 平台特定配置

**重要配置项**：
```json
{
  "name": "君安否",
  "appid": "__UNI__XXXXXX",
  "versionName": "1.0.0",
  "versionCode": "100",
  "mp-weixin": {
    "appid": "你的小程序AppID"
  }
}
```

---

#### `package.json`
**功能**：项目依赖配置
- 项目信息
- 依赖包管理
- 脚本命令

**脚本命令**：
```bash
npm run dev:mp-weixin    # 开发模式
npm run build:mp-weixin  # 生产构建
```

---

#### `vite.config.js`
**功能**：Vite构建配置
- 构建选项
- 插件配置
- 路径别名

---

### 📱 应用文件

#### `App.vue`
**功能**：应用入口
- 全局样式定义
- 生命周期钩子
- 全局配置

**生命周期**：
- `onLaunch` - 应用启动
- `onShow` - 应用显示
- `onHide` - 应用隐藏

---

### 📚 文档文件

#### `README.md`
项目基本说明和快速开始指南

#### `CHANGELOG.md`
版本更新日志，记录所有重要变更

#### `前端开发完善说明.md`
详细的功能说明和开发文档

#### `部署配置说明.md`
部署和配置的详细步骤

#### `项目结构说明.md`
项目结构和文件说明（本文件）

---

## 数据流转图

```
┌─────────────────────────────────────────────────────────┐
│                        用户操作                          │
└──────────────────────┬──────────────────────────────────┘
                       │
                       ▼
┌─────────────────────────────────────────────────────────┐
│                    页面组件 (.vue)                       │
│  ┌──────────┐  ┌──────────┐  ┌────────────────┐        │
│  │ 首页     │  │ 用户信息 │  │ 签到记录       │        │
│  │ index    │  │ info     │  │ records        │        │
│  └────┬─────┘  └────┬─────┘  └────┬───────────┘        │
└───────┼─────────────┼─────────────┼────────────────────┘
        │             │             │
        ▼             ▼             ▼
┌─────────────────────────────────────────────────────────┐
│                    工具类 (utils/)                       │
│  ┌────────────┐  ┌────────────┐  ┌─────────────┐       │
│  │ api.js     │  │ store.js   │  │ validate.js │       │
│  │ (接口调用) │  │ (状态管理) │  │ (表单验证)  │       │
│  └─────┬──────┘  └─────┬──────┘  └─────────────┘       │
└────────┼────────────────┼─────────────────────────────┘
         │                │
         │                ▼
         │        ┌────────────────┐
         │        │ uni.storage    │
         │        │ (本地存储)      │
         │        └────────────────┘
         │
         ▼
┌─────────────────────────────────────────────────────────┐
│                    后端 API                              │
│  ┌──────────────────┐  ┌──────────────────┐            │
│  │ POST /api/sign   │  │ GET /api/user/   │            │
│  │                  │  │      info        │            │
│  └──────────────────┘  └──────────────────┘            │
│  ┌──────────────────┐                                   │
│  │ GET /api/sign/   │                                   │
│  │     records      │                                   │
│  └──────────────────┘                                   │
└─────────────────────────────────────────────────────────┘
```

---

## 页面跳转关系

```
首页 (index)
    │
    ├─→ 用户信息页 (info)
    │       │
    │       └─→ 签到记录页 (records)
    │
    └─→ 签到记录页 (records)
```

---

## 状态管理流程

```
1. 应用启动
   └─→ store 从 uni.storage 加载用户信息

2. 用户签到
   └─→ 调用 signIn() 接口
       └─→ 成功后调用 store.updateSignInfo()
           └─→ 更新本地状态并持久化

3. 查看用户信息
   └─→ 从 store.getUserInfo() 获取
       └─→ 如果没有，调用 API 获取
           └─→ 调用 store.setUserInfo() 保存

4. 页面切换
   └─→ onShow 生命周期触发
       └─→ 从 store 获取最新状态
           └─→ 更新页面显示
```

---

## 本地存储键名

| 键名 | 类型 | 说明 |
|-----|------|------|
| `userName` | String | 用户姓名（用于表单回填） |
| `userEmail` | String | 用户邮箱（用于表单回填） |
| `userInfo` | JSON | 完整的用户信息对象 |

---

## 核心依赖

| 依赖 | 版本 | 说明 |
|-----|------|------|
| `@dcloudio/uni-app` | ^3.0.0 | uni-app核心 |
| `@dcloudio/uni-mp-weixin` | ^3.0.0 | 微信小程序运行时 |
| `vue` | ^3.4.21 | Vue 3框架 |
| `vite` | ^5.0.0 | 构建工具 |

---

## 浏览器兼容性

- ✅ 微信小程序（基础库 2.0+）
- ✅ iOS 10.0+
- ✅ Android 5.0+

---

## 代码风格

- 使用 **Vue 3 Composition API** 或 **Options API**
- 使用 **ES6+** 语法
- 使用 **SCSS** 预处理器
- 遵循 **ESLint** 规范（如果配置）
- 组件文件使用 **PascalCase** 或 **kebab-case** 命名

---

**文档版本**: v1.0  
**最后更新**: 2026-02-04
